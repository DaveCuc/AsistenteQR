<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escanear código QR</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js" integrity="sha512-L0Shl7nXXzIlBSUUPpxrokqq4ojqgZFQczTYlGjzONGTDAcLremjwaWv5A+EDLnxhQzY5xUZPWLOLqYRkY0Cbw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
  <!-- Carga de la librería html5-qrcode desde node_modules -->
  <script src="node_modules/html5-qrcode/minified/html5-qrcode.min.js" type="text/javascript"></script>
</head>
<body>
  <div class="row justify-content-center mt-5">
    <div class="col-sm-4 shadow p-3">
      <h5 class="text-center">Asistente de Registro</h5>
      <p>Bienvenido al Asistente para el Registro de Asistencia del Congreso</p>

      <!-- Contenedor del lector de QR -->
      <div id="reader" style="width: 100%; height: 400px;"></div>

      <div class="row text-center mt-3">
        <!-- Botón para iniciar el escáner -->
        <a id="btn-scan-qr" href="#" onclick="iniciarEscaneo()">
          <img src="https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2017/07/1499401426qr_icon.svg" class="img-fluid text-center" width="175">
        </a>
      </div>
      
      <div class="row mx-5 my-3">
        <button class="btn btn-success btn-sm rounded-3 mb-2" onclick="encenderCamara()">Actualizar Scanner</button>
        <button class="btn btn-danger btn-sm rounded-3" onclick="cerrarCamara()">Cancelar</button>
      </div>

      <p>Para registrar la asistencia de los estudiantes, sigue estos pasos:</p>
      <p>1. Escanea el Código QR (Puede tardar un momento)</p>
      <p>2. Verificación del Estudiante (El sistema comprobará automáticamente el código QR)</p>
      <p>3. Confirmación (Serás redirigido a otra página con la confirmación de registro)</p>

    </div>
  </div>

  <!-- Enlace a archivo JS externo -->
  <script src="assets/js/index.js"></script>

  <script>
    // Configuración y funciones para el lector de código QR
    function onScanSuccess(decodedText, decodedResult) {
      console.log(`Código QR detectado: ${decodedText}`);
      alert("Código QR detectado");
    }

    function onScanFailure(error) {
      console.warn(`Error en el escaneo: ${error}`);
    }

    let html5QrcodeScanner = new Html5QrcodeScanner(
      "reader",
      { fps: 10, qrbox: { width: 250, height: 250 } },
      false
    );

    // Inicializa el escáner
    html5QrcodeScanner.render(onScanSuccess, onScanFailure);

    // Función para iniciar el escáner
    function iniciarEscaneo() {
      html5QrcodeScanner.clear();
      html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    }

    // Función para encender la cámara
    function encenderCamara() {
      html5QrcodeScanner.clear();
      html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    }

    // Función para cerrar la cámara
    function cerrarCamara() {
      html5QrcodeScanner.clear();
    }
  </script>
</body>
</html>
